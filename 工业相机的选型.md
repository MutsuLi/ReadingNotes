# 工业相机

<!-- ## 1. 工业相机简介

* 工业相机，不能简单地理解为工业上用的相机，它是有特殊用途的一类相机统称.

    > 特殊用途：比如3D重建算法，对相机的畸变要求尽量小，在某些恶劣场合，需要用到IP67级防水相机、拍摄原子弹爆炸前几微秒内原子弹内部的场景，这类专门的相机可以称为高速相机，这些相机都可以称为工业相机。而相反的，工厂里监控摄像头并不是是工业相机.

* 与一般相机的区别:

    1. 配备专门软件开发工具包（Software Development Kit，SDK），我们可以通过代码设置包括：曝光时间、触发方式、图像分辨率、成像帧率等等一系列相机参数（下面是某款相机SDK的图像界面）。

    2. 成像精准：一般来说，工业相机的图像传感器是逐行扫描的，而普通传感器是隔行扫描的，前者生产工艺更为复杂，成品率低、出货量少，世界上只有少数公司能够提供这类产品。此外，工业相机的畸变、色彩还原准确度往往更好，而单反相机追求的是要拍的好看。

    3. 稳定性和可靠性：工业相机的性能稳定可靠、易于安装，结构紧凑结实不易损坏，连续工作时间长，可在较差的环境下工作，这是单反相机做不到的. -->

## 1. 工业相机的分类

![avatar](./picture/工业相机的分类.png)

### 1.1 线阵与面阵相机

* 面阵相机：实现的是像素矩阵拍摄。优点在于可以获取二维图像信息，测量图像直观适用多种场合, 缺点在于像元总数多，但每行的像元数一般较线阵少，帧幅率受到限制.
* 线阵相机：与面阵工业相机相比，它的传感器只有一行感光元素，因此使高扫描频率和高分辨率成为可能, 线阵工业相机非常适合测量一维动态物体，可以准确测量到微米。缺点在于要用线阵获取二维图像，必须配以扫描运动，而且为了能确定图像每一像素点在被测件上的对应位置，还必须配以光栅等器件以记录线阵每一扫描行的坐标。

### 1.2 CCD与CMOS
- CCD 与CMOS 图像传感器光电转换的原理相同，最主要的差别在于信号的读出过程不同.从功耗角度而言,CMOS低于CCD,从速度而言,CMOS也优于CCD,但是由于CMOS的图像噪声较大,图像质量较差.

## 2. 工业相机的接口

* 工业相机的接口主要有三种类型：

    > 1. 镜头接口：固定相机跟镜头，也称为卡口；
    > 2. 数据接口（控制）：传输拍摄到的相机数据（控制相机）；
    > 3. 电源接口（控制）：提供相机电源（控制相机）；
    > 4. 数据口和电源口也会放一起，接口既能提供数据传输又能提供相机电源

 * 镜头接口:
 >* 常见的工业相机镜头接口包括：C、CS、M42、M50、F、V、T2等等，接口类型的不同和工业相机镜头性能、质量并无直接关系，仅仅是接口方式不一样. 一般而言, 相机接口与相机镜头是对应的.
 >* 相机镜头的C、CS接口非常相似，它们的接口直径、螺纹间距都是一样的，仅仅是法兰距不同。C接口的法兰距是17.5mm，CS接口的法兰距是12.5mm。因此对于CS接口的相机，如果想要接入C接口的镜头，只需要一个5mm厚的CS-C转换环即可。而CS型镜头与C型摄像机无法配合使用。
 >* 法兰距：也叫做像场定位距离，是指机身上镜头卡口平面与机身曝光窗平面之间的距离，即镜头卡口到感光元件（一般是CMOS或CCD）之间的距离。注意，法兰距不同，即便装上也无法清晰对焦和成像

![avatar](./picture/物理接口类型.jpg)

 * 数据/电源接口:

![avatar](./picture/数据+电源接口对比.png)

<!-- | 接口 | USB2.0 | USB3.0|IEEE1394 | GIGE|Cameralink| CoaxPress|
| :-----| ----: | :----: | :-----| ----: | :----: |:----: |:----: |
| 带宽(gbit/s) | 0.48 | 5 |0.8|1|2.04/4.09/5.44|1.25/3.12/6.25(4通道25)|
| 长度(m) | 3-5 | 3-5 |100|3-5|10|170/130/50|
| 价格 | 低| 低 |低|低|高|低|
| 使用 |直接 | 直接 |转接头|千兆|拓展|拓展|
| 供电 | 独立 | 独立 | 独立|额外|独立|独立| -->

<!-- * USB2.0、3.0系列：这类接口的好处是即插即用（虽然这里说是即插即用，但一般工业相机都还是要安装驱动以及相应的SDK才能调用的），3.0的速度达到了5.0GB，但问题是传输的线路太短，不太适合长距离、大批量工业相机的应用场景（这在大多数化工企业中是这样，相机安装在工厂的各个角落，处理放在主控室）。

* IEEE1394：Apple公司推出的标准，传输速度介于USB2.0~3.0之间（还是比较慢的），传输距离达到了100m，但是其需要额外的转接头，因此应用也不多。

* GIGE：也就是常说的网口相机，传输速度虽然不高（一般来说也够用了），但是传输距离远，集成方便，配合上千兆路由器，可以实现大规模的工业相机集成，目前工业应用上最为广泛，较为高端的工业相机也大多采用这种配置，唯一的缺点是需要额外的电源供电。

* Cameralink：一种专门的工业级视觉产品使用行业标准，传输速度可以达到5.44Gbit/s，往往用在之前的一些高速相机上(因为之前USB2.0、GIGE这些接口都太慢了)，但缺点是需要额外的图像采集卡、价格贵（一条线缆1000）、而且不好用，要自己去写相机驱动，并且不支持热插拔（会损坏相机！）。

    >原因：使用这类接口的相机在物理上被硬生生地拆为两部分，相机的厂商只负责相机的制造，而相应的驱动、软件，比如说图像的采集、处理等算法都需要你自己对CameraLink采集卡进行编程。

* CiaXPress：速度快、传输距离远，独立供电、价格也便宜，推出来用以取代Cameralink接口。这类相机需要额外的接口卡，注意，这里是接口卡！接口卡不同于采集卡，其只是相机采集到的数据的一个中转站，不会对数据做任何处理，其直接将数据存储在主寄存器中。

    >因为这类相机传输速度较快，如果将拷贝数据的工作交给CPU来做的话，CPU将会消耗大量资源. -->

## 3. 镜头参数

 * 焦距(f)，对于单片凸透镜来说，焦距通常指平行光线经凸透镜汇聚后一点到透镜中心的这段距离。通常，这个距离在制造完成后就不可变的，也就是说一块凸透镜的焦距是不会发生变化的。

 * 景深(Depth of view，EOF)：物体离最佳焦点较近或较远时，镜头保持所需分辨率的能力。焦点附近，也就是在景深范围内清晰，而前后方景物都比较模糊

![avatar](./picture/景深.png)

 * 光圈(Aperture): 光圈大小是用 f 值来刻画的，意思是开了几分之几，影响镜头的进光量。光圈值为f/2.0，意思是开了1/2。
 

![avatar](./picture/光圈.png)

<!-- ## 3.1 常见镜头标识

* 关于工业相机中常见的镜头标识大致如下：

![avatar](./picture/镜头标志.png) -->

## 4. 相机参数

*  分辨率（Resolution）：相机每次采集图像的像素点数（Pixels）。由工业相机所采用的芯片分辨率决定，是芯片靶面排列的像元数量。分辨率影响采集图像的质量，在对同样大的视场（景物范围）成像时，分辨率越高，对细节的展示越明显。

* 像元大小: 单个像素的物理尺寸大小，一般来说，像元尺寸越小，制造难度越大，图像质量也越不容易提高。目前工业数字相机像元尺寸一般为3~4 。

* 靶面尺寸: 图像传感器的感光部分的大小。 常见的靶面有1/4''、1/3''、1/2''、2/3''、1''等几种，当然也有其他规格。靶面尺寸规格见下表.

    > 像元大小和像元数（分辨率）两者共同决定相机靶面的大小，是此消彼长的关系，所以我们选择相机的时候也并不是分辨率越高越好，而是挑选合适的分辨率。

* 像素深度（Pixel Depth）：每位像素数据的位数，常见的是8bit，10bit，12bit。分辨率和像素深度共同决定了图像的大小。例如对于像素深度为8bit的500万像素，则整张图片应该有500万*8/1024/1024=37M

* 最大帧率（Frame Rate）/行频（Line Rate）：相机采集传输图像的速率，对于面阵相机一般为每秒采集的帧数（FPS），对于线阵相机机为每秒采集的行数（Hz).

* 曝光方式（Exposure）和快门速度（Shutter）: 线阵相机为逐行曝光的方式，可以选择固定行频和外触发同步的采集方式，曝光时间可以与行周期一致，也可以设定一个固定的时间；面阵相机有帧曝光、场曝光和滚动行曝光等几种常见方式，工业数字相机一般都提供外触发采图的功能。快门速度一般可到10微秒，高速相机还可以更快.

* 曝光时间: 也称为快门速度，指从快门打开到关闭的时间间隔，在这一段时间内，物体可以在底片上留下影像。

* 光谱响应特性: 指传感器对不同光波的敏感特性，一般来说，响应范围都在350nm~1000nm间。有的相机在靶面前面会增加一个滤镜，滤除红外线，如果系统需要多红外光感应，可以去除该滤镜。

* 信噪比: 相机的信噪比定义为图像中信号与噪声的比值，代表了图像的质量，图像信噪比越高，相机性能和图像质量越好

## 5. 相机和镜头选取

* 相关参数
    - 视场(Field of view, FOV) ：指观测物体的可视范围，也就是充满相机采集芯片的物体部分。

        > - 视场（FOV）=工作距离（WD）*CCD靶面型号尺寸（V或者H）/焦距（f）
        > - FOVmin=SS(感光面积)（Dmin(最小物距)/FL(焦距))

    - 工作距离(Working Distance, WD) ：指从镜头前部到受检验物体的距离。即清晰成像的表面距离。

    - 视场角（Angle of View, FOV）：影响理论视场范围.
    - 光学放大倍数（Magnification, B）：芯片尺寸除以视野范围；

        > - 光学放大倍数(PMAG)=CCD靶面型号尺寸（V或者H）/视场尺寸（V或者H）=像的尺寸/实际物体的尺寸

* 镜头：

    - 镜头接口: 跟相机接口匹配，也可以外加转换口后匹配，并且镜头可支持的最大CCD尺寸应大于选配相机CCD尺寸大小。
    - 镜头焦距

        >- 焦距（f）=工作距离（WD）*CCD靶面型号尺寸（V或者H）/视场大小或者物体高度（FOV）
        

![avatar](./picture/焦距.png)

    - 镜头光圈范围:

        >- 光圈大小决定图像亮度，在拍摄高速运动物体、曝光时间很短的应用中，应选用大光圈镜头以提高图像亮度。
